# Redis配置文件
# 绑定地址
bind 0.0.0.0

# 端口
port 6379

# 后台运行
daemonize no

# 日志级别
loglevel notice

# 日志文件
logfile ""

# 数据库数量
databases 16

# 密码认证
requirepass aA123456@

# ACL用户配置
# 创建admin用户，密码为aA123456@，拥有所有权限
user admin on >aA123456@ ~* &* +@all

# 禁用默认用户
user default off

# AOF持久化配置
# 开启AOF
appendonly yes

# AOF文件名
appendfilename "appendonly.aof"

# AOF同步策略：每秒同步一次
appendfsync everysec

# 在AOF重写时不进行fsync
no-appendfsync-on-rewrite no

# AOF重写触发条件
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# AOF加载时忽略最后一个不完整的命令
aof-load-truncated yes

# 混合持久化（AOF + RDB）
aof-use-rdb-preamble yes

# RDB持久化配置（作为备份）
save 900 1
save 300 10
save 60 10000

# RDB文件名
dbfilename dump.rdb

# 工作目录
dir /data

# 内存管理
maxmemory-policy allkeys-lru

# 网络配置
tcp-keepalive 300
timeout 0

# 客户端连接数限制
maxclients 10000

# 慢查询日志
slowlog-log-slower-than 10000
slowlog-max-len 128

# 禁用危险命令
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command KEYS ""
rename-command CONFIG "CONFIG_b835c3f1a2b7e4d8"

# 关闭主从复制相关配置
# 确保不启用主从模式
# replicaof <masterip> <masterport> # 注释掉，不配置主服务器
# masterauth <master-password>     # 注释掉，不配置主服务器密码

# 禁用从服务器只读模式（因为我们不使用主从）
# replica-read-only yes # 注释掉

# 安全配置
protected-mode yes

# 禁用一些不安全的命令
rename-command DEBUG ""
rename-command EVAL ""
rename-command SCRIPT ""